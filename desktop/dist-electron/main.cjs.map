{
  "version": 3,
  "sources": ["../src/main/main.ts"],
  "sourcesContent": ["// main process. creates window, runs monitoring loop, and handles IPC from renderer\r\n\r\nimport { app, BrowserWindow, ipcMain } from 'electron';\r\nimport path from 'node:path';\r\nimport activeWin from 'active-win';\r\n\r\nlet mainWindow: BrowserWindow | null = null;\r\n\r\ntype SessionState = {       // state of the current focus session\r\n  running: boolean;\r\n  blacklist: string[];\r\n  centsOwed: number;\r\n  feePerMin: number; // $/minute, e.g. 0.25\r\n  lastCheck: number;\r\n};\r\nconst state: SessionState = {       //initial state of session\r\n  running: false,\r\n  blacklist: ['youtube', 'twitter', 'instagram', 'steam'],\r\n  centsOwed: 0,\r\n  feePerMin: 0.25,\r\n  lastCheck: Date.now(),\r\n};\r\n\r\n// Debounce: require 2 consecutive ticks of same state to avoid flickering\r\nlet lastRawDistracted: boolean | null = null;\r\nlet displayedDistracted = false;\r\n\r\nasync function createWindow() {         //creates the desktop window and loads the React app\r\n  mainWindow = new BrowserWindow({\r\n    width: 1100,\r\n    height: 720,\r\n    webPreferences: {\r\n        preload: path.join(__dirname, 'preload.cjs'),\r\n        contextIsolation: true,\r\n        nodeIntegration: false,\r\n},\r\n\r\n \r\n\r\n\r\n  });\r\n\r\n  const isDev = !!process.env.VITE_DEV_SERVER;      // dev commands.  VITE_DEV_SERVER in development mode\r\n  if (isDev) {\r\n    await mainWindow.loadURL(process.env.VITE_DEV_SERVER_URL || 'http://localhost:5173');\r\n  } else {\r\n    await mainWindow.loadFile(path.join(__dirname, '../../dist/index.html'));\r\n  }\r\n\r\n  mainWindow.on('closed', () => {\r\n    mainWindow = null;\r\n  });\r\n}\r\n\r\napp.whenReady().then(createWindow);         //lifecycle events\r\napp.on('window-all-closed', () => {\r\n  if (process.platform !== 'darwin') app.quit();\r\n});\r\napp.on('activate', () => {                  //macOS behavior: re-create window when dock icon is clicked and no other windows are open\r\n  if (BrowserWindow.getAllWindows().length === 0) createWindow();\r\n});\r\n\r\n// Helper: does a window match any blacklist term? (title or app name)\r\nfunction windowMatchesBlacklist(win: { title?: string; owner?: { name?: string } } | null | undefined, blacklist: string[]): boolean {\r\n  if (!win) return false;\r\n  const title = (win.title || '').toLowerCase();\r\n  const ownerName = (win.owner?.name || '').toLowerCase();\r\n  return blacklist.some(b => title.includes(b) || ownerName.includes(b));\r\n}\r\n\r\n// Use getOpenWindows only (front-to-back order) \u2014 single source of truth avoids race with activeWin()\r\n// Debounce: require 2 consecutive ticks of same state to prevent flickering\r\nsetInterval(async () => {\r\n  if (!state.running || !mainWindow) return;\r\n  try {\r\n    const openWindows = await (activeWin.getOpenWindows?.() ?? Promise.resolve([]));\r\n    const win = Array.isArray(openWindows) && openWindows.length > 0 ? openWindows[0] : null;\r\n\r\n    const now = Date.now();\r\n    const elapsedMin = (now - state.lastCheck) / 60000;\r\n\r\n    // Fees ONLY when BOTH: (1) a blacklisted app is open, AND (2) you're focused on it\r\n    const blacklistAppIsOpen = Array.isArray(openWindows) && openWindows.some((w: any) => windowMatchesBlacklist(w, state.blacklist));\r\n    const activeMatches = windowMatchesBlacklist(win, state.blacklist);\r\n    const isOwnApp = win?.owner?.name?.toLowerCase().includes('electron') || (win?.title || '').toLowerCase().includes('focus fee');\r\n    const rawDistracted = blacklistAppIsOpen && activeMatches && !isOwnApp;\r\n\r\n    // Debounce: only switch state after 2 consecutive same ticks\r\n    if (lastRawDistracted === null || lastRawDistracted === rawDistracted) {\r\n      displayedDistracted = rawDistracted;\r\n    }\r\n    lastRawDistracted = rawDistracted;\r\n\r\n    if (displayedDistracted) {\r\n      state.centsOwed += Math.ceil(elapsedMin * state.feePerMin * 100);\r\n    }\r\n    state.lastCheck = now;\r\n\r\n    mainWindow.webContents.send('tick', {\r\n      distracted: displayedDistracted,\r\n      centsOwed: state.centsOwed,\r\n      activeTitle: win?.title || '',\r\n    });\r\n  } catch (e) {\r\n    // swallow errors to keep loop alive\r\n  }\r\n}, 1500);\r\n\r\n// IPC handlers for control\r\nipcMain.handle('session:start', (_e, payload: { blacklist: string[]; feePerMin: number }) => {\r\n  state.blacklist = payload.blacklist.map(s => s.toLowerCase());\r\n  state.feePerMin = payload.feePerMin;\r\n  state.centsOwed = 0;\r\n  state.lastCheck = Date.now();\r\n  state.running = true;\r\n  lastRawDistracted = null;\r\n  displayedDistracted = false;\r\n  return { ok: true };\r\n});\r\n\r\nipcMain.handle('session:stop', () => {      // stop session and return total cents owed\r\n  state.running = false;\r\n  return { centsOwed: state.centsOwed };\r\n});\r\n"],
  "mappings": "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",
  "names": ["path", "activeWin"]
}
